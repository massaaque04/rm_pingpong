<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pongg</title>
    <style>
        #quadro {
            border: 2px solid #000;
            background: rgb(0, 0, 0);
            display: block;
            margin: 0 auto;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.js"
        integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
</head>

<body>
    <canvas id="quadro" width="1000" height="600"></canvas>

    <script>
        $().ready(function () {
            var canvas = $("#quadro")[0];
            var ctx = canvas.getContext("2d");

            var colisao = false;

            var pontosP1 = 0;
            var pontosP2 = 0;

            var p1 = {
                "vx": 0,
                "vy": 0,
                "x": 50,
                "y": canvas.height / 2 - 35,
                "l": 10,
                "a": 80,
                "cor": "blue",
                atualiza: function () {
                    this.x += this.vx;
                    this.y += this.vy;
                },
                desenharObjeto: function () {
                    ctx.fillStyle = this.cor;
                    ctx.fillRect(this.x, this.y, this.l, this.a);
                }
            }

            var p2 = {
                "vx": 0,
                "vy": 0,
                "x": canvas.width - 50,
                "y": canvas.height / 2 - 35,
                "l": 10,
                "a": 80,
                "cor": "red",
                atualiza: function () {
                    this.x += this.vx;
                    this.y += this.vy;
                },
                desenharObjeto: function () {
                    ctx.fillStyle = this.cor;
                    ctx.fillRect(this.x, this.y, this.l, this.a);
                }
            }

            var bolinha = {
                "vx": -3,
                "vy": 3,
                "x": canvas.width / 2,
                "y": canvas.height / 2,
                "raio": 8,
                "cor": "white",

                atualiza: function () {
                    this.x += this.vx;
                    this.y += this.vy;
                },

                desenharObjeto: function () {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.raio, 0, Math.PI * 2);
                    ctx.fillStyle = this.cor;
                    ctx.fill();
                    ctx.closePath();
                }
            };

            function detectaColisaoCQ(bolinha, p) {
                let maisProximoX = Math.max(p.x, Math.min(bolinha.x, p.x + p.l));
                let maisProximoY = Math.max(p.y, Math.min(bolinha.y, p.y + p.a));

                let distX = bolinha.x - maisProximoX;
                let distY = bolinha.y - maisProximoY;
                let distancia = Math.sqrt(distX * distX + distY * distY);

                if (distancia < bolinha.raio) {
                    colisao = true;
                    bolinha.vx *= -1;
                } else {
                    colisao = false;
                }
            }

            function reiniciaBolinha() {
                bolinha.x = canvas.width / 2;
                bolinha.y = canvas.height / 2;

                // direção horizontal
                if (Math.random() > 0.5) {
                    bolinha.vx = 3;
                } else {
                    bolinha.vx = -3;
                }

                // direção vertical
                if (Math.random() > 0.5) {
                    bolinha.vy = 3;
                } else {
                    bolinha.vy = -3;
                }
            }

            function desenharTela() {
                apagarTela();

                p1.atualiza();
                detectaLimite(p1);
                p1.desenharObjeto();

                p2.atualiza();
                detectaLimite(p2);
                p2.desenharObjeto();

                bolinha.atualiza();
                detectaLimite(bolinha);
                bolinha.desenharObjeto();

                detectaColisaoCQ(bolinha, p1)
                detectaColisaoCQ(bolinha, p2)

                // desenhar placar
                ctx.fillStyle = "white";
                ctx.font = "30px Arial";
                ctx.fillText(pontosP1, canvas.width / 4, 50);
                ctx.fillText(pontosP2, 3 * canvas.width / 4, 50);

                requestAnimationFrame(desenharTela);
            }

            function detectaLimite(obj) {
                // limites para jogadores
                if (obj === p1 || obj === p2) {
                    if (obj.y < 0) {
                        obj.y = 0;
                        obj.vy = 0;
                    }
                    if (obj.y + obj.a > canvas.height) {
                        obj.y = canvas.height - obj.a;
                        obj.vy = 0;
                    }
                }

                // limites para a bolinha
                if (obj === bolinha) {
                    if (bolinha.y - bolinha.raio < 0 || bolinha.y + bolinha.raio > canvas.height) {
                        bolinha.vy *= -1;
                    }

                    if (bolinha.x - bolinha.raio < 0) {
                        pontosP2++;
                        reiniciaBolinha();
                    }

                    if (bolinha.x + bolinha.raio > canvas.width) {
                        pontosP1++;
                        reiniciaBolinha();
                    }
                }
            }

            function apagarTela() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            desenharTela();

            $(window).keydown(function (event) {
                if (event.which == 38) { //seta cima
                    p1.vy = -3;
                }
                if (event.which == 40) { //seta baixo
                    p1.vy = 3;
                }
                if (event.which == 87) { // tecla W
                    p2.vy = -3;
                }
                if (event.which == 83) { // tecla S
                    p2.vy = 3;
                }
            });

            $(window).keyup(function (event) {
                if (event.which == 38 || event.which == 40) {
                    p1.vy = 0;
                }
                if (event.which == 87 || event.which == 83) {
                    p2.vy = 0;
                }
            });
        });
    </script>
</body>

</html>
