<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pongg</title>
    <style>
        #quadro {
            border: 2px solid #000;
            background: rgb(0, 0, 0);
            display: block;
            margin: 0 auto;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.js"
        integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
</head>

<body>
        <canvas id="quadro" width="1000" height="600"></canvas>

    <script>
       $().ready(function () {
            var canvas = $("#quadro")[0];
            var ctx = canvas.getContext("2d");

            colisao = false
    var p1 = {
        "vx": 0,
        "vy": 0,
        "x": 50,
        "y": canvas.height/2 - 35,
        "l": 10,
        "a": 80,
        "cor": "blue",
        atualiza: function () {
            this.x += this.vx;  
            this.y += this.vy;
        },
        desenharObjeto: function () {
            ctx.fillStyle = this.cor;
            ctx.fillRect(this.x, this.y, this.l, this.a);
        }
    }

    var p2 = {
        "vx": 0,
        "vy": 0,
        "x": canvas.width - 50, // lado direito
        "y": canvas.height/2 - 35,
        "l": 10,
        "a": 80,
        "cor": "red",
        atualiza: function () {
            this.x += this.vx;
            this.y += this.vy;
        },
        desenharObjeto: function () {
            ctx.fillStyle = this.cor;
            ctx.fillRect(this.x, this.y, this.l, this.a);
        }
    }

    var bolinha = {
    "vx": -3,
    "vy": 3,
    "x": canvas.width / 2, 
    "y": canvas.height / 2,
    "raio": 8,     
    "cor": "white",

    atualiza: function () {
        this.x += this.vx;
        this.y += this.vy;
    },

    desenharObjeto: function () {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.raio, 0, Math.PI * 2); // círculo completo
        ctx.fillStyle = this.cor;
        ctx.fill();
        ctx.closePath();
    }
};

function detectaColisaoCQ(bolinha, p) {
    // Pega o ponto mais próximo do centro da bola dentro do retângulo
    let maisProximoX = Math.max(p.x, Math.min(bolinha.x, p.x + p.l));
    let maisProximoY = Math.max(p.y, Math.min(bolinha.y, p.y + p.a));

    // Calcula a distância entre o centro da bola e esse ponto
    let distX = bolinha.x - maisProximoX;
    let distY = bolinha.y - maisProximoY;
    let distancia = Math.sqrt(distX * distX + distY * distY);

    // Se a distância for menor que o raio, houve colisão
    if (distancia < bolinha.raio) {
        colisao = true;
        // Inverte a direção da bola no eixo X
        bolinha.vx *= -1;
    } else {
        colisao = false;
    }
}


    function desenharTela() {
        apagarTela();

        p1.atualiza();
        detectaLimite(p1);
        p1.desenharObjeto();

        p2.atualiza();
        detectaLimite(p2);
        p2.desenharObjeto();

        bolinha.atualiza();
        detectaLimite(bolinha);
        bolinha.desenharObjeto();
        
        detectaColisaoCQ(bolinha, p1)
        detectaColisaoCQ(bolinha, p2)
        
        requestAnimationFrame(desenharTela);


    }

    function detectaLimite(p1) {
        if (p1.x < 0) {
            p1.x = 0;
            p1.vx = 0;
        }
        if (p1.y < 0) {
            p1.y = 0;
            p1.vy = 0;
        }
        if (p1.x + p1.l > canvas.width) {
            p1.x = canvas.width - p1.l;
            p1.vx = 0;
        }
        if (p1.y + p1.a > canvas.height) {
            p1.y = canvas.height - p1.a;
            p1.vy = 0;
        }
    }

    function detectaLimite(p2) {
        if (p2.x < 0) {
            p2.x = 0;
            p2.vx = 0;
        }
        if (p2.y < 0) {
            p2.y = 0;
            p2.vy = 0;
        }
        if (p2.x + p2.l > canvas.width) {
            p2.x = canvas.width - p2.l;
            p2.vx = 0;
        }
        if (p2.y + p2.a > canvas.height) {
            p2.y = canvas.height - p2.a;
            p2.vy = 0;
        }
    }

    function detectaLimite(bolinha) {
        if (bolinha.y < 0 || bolinha.y > canvas.height) {
            //bolinha.y = 0;
            bolinha.vy = bolinha.vy * -1;
        }
        if (bolinha.y + bolinha.raio > canvas.height) {
            //bolinha.y = canvas.height - bolinha.a;
            bolinha.vy = bolinha.vy * -1;
        }

        if (bolinha.x < 0) {
            bolinha.x = 0;
            bolinha.vx = 0;
        }

        if (bolinha.x + bolinha.raio > canvas.width) {
            bolinha.x = canvas.width - bolinha.l;
            bolinha.vx = 0;
        }
        
    }



    function apagarTela() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    desenharTela();
    
    $(window).keydown(function (event) {
        if (event.which == 38) { //seta cima
            p1.vy = -3;
            p1.vx = 0;
        }
        if (event.which == 40) { //seta baixo
            p1.vy = 3;
            p1.vx = 0;
        }
        if (event.which == 87) { // tecla W
        p2.vy = -3;
        p2.vx = 0;
        }
        if (event.which == 83) { // tecla S
            p2.vy = 3;
            p2.vx = 0;
        }
    });
    $(window).keyup(function (event) {
    if (event.which == 38 || event.which == 40) {
        p1.vy = 0;
    }
    if (event.which == 87 || event.which == 83) {
        p2.vy = 0;
    }
});
});
    </script>
</body>

</html>
